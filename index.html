<!DOCTYPE html>
<html>
<head>
    <link rel="stylesheet" type="text/css" href="style.css">
    <title>calculator</title>
    <style>
    </style>
</head>

<body>
    <div class = 'calc-buttons'>

        <button class = 'input-buttons' id = 'b0'>0</button>
        <button class = 'input-buttons' id = 'b1'>1</button>
        <button class = 'input-buttons' id = 'b2'>2</button>
        <button class = 'input-buttons' id = 'b3'>3</button>
        <button class = 'input-buttons' id = 'b4'>4</button>
        <button class = 'input-buttons' id = 'b5'>5</button>
        <button class = 'input-buttons' id = 'b6'>6</button>
        <button class = 'input-buttons' id = 'b7'>7</button>
        <button class = 'input-buttons' id = 'b8'>8</button>
        <button class = 'input-buttons' id = 'b9'>9</button>
        <button class = 'input-buttons' id = 'bdot'>.</button>

        <button class = 'input-buttons' id = 'bmul'>*</button>
        <button class = 'input-buttons' id = 'bdiv'>/</button>
        <button class = 'input-buttons' id = 'badd'>+</button>
        <button class = 'input-buttons' id = 'bsub'>-</button>


        <button id = 'benter'>=</button>
        <button id = 'bclear'>clear</button>
        <button class = 'bback'>back</button>

        <p class = 'input'></p>
        <p class = 'result'></p>

        

    </div>


    <script>

    // declerations
    const inputButtons = document.querySelectorAll('button');
    let disp = {};
    let dispArr = [];
    let result = 0;
    let opFlag = 0;
    let last = '';
    let back = '';
    let final = 0;
    let lastSpaceIndex = 0;
    let invalidFlag = 0;


    // defines math functions
    function add (x,y) {
        // converts from number strings from input field
        if (typeof x != 'number') x = Number(x);
        if (typeof y != 'number') y = Number(y);
        return x + y;
    }
    function subtract (x,y) {
        if (typeof x != 'number') x = Number(x);
        if (typeof y != 'number') y = Number(y);
        return x - y;
    }
    function multiply (x,y) {
        if (typeof x != 'number') x = Number(x);
        if (typeof y != 'number') y = Number(y);
        return x * y;
    }
    function divide (x,y) {
        if (typeof x != 'number') x = Number(x);
        if (typeof y != 'number') y = Number(y);
        return x / y;  
    }

    //button input handlers    
    inputButtons.forEach((button) => {
        button.addEventListener('click', (e) => {

            // when buttons that add to the input are pressed
            if(e.path[0].className == 'input-buttons') {

                // if the results and inputs of a previous calculation is still being displayed, clear it before adding more to input
                if (opFlag == 1) clear();
                opFlag = 0;

                // padd operators on left and right 
                if (e.path[0].id == 'bmul' || e.path[0].id == 'bdiv' || e.path[0].id == 'badd' || e.path[0].id == 'bsub') {
                    document.querySelector('.input').innerHTML += ' ' + button.textContent + ' ';

                    // last will be used later for the back function, it is the last entered character
                    last = button.textContent;
                } else {

                    // add button text to input string (button text is hidden with CSS justify trick)
                    document.querySelector('.input').innerHTML += button.textContent;
                    last = button.textContent;
                }   

            // when enter button is pressed
            } else if (e.path[0].id == 'benter') {

                // creates space delineated array from display string
                dispText = document.querySelector('.input').textContent.replace('  ',' ');
                dispArr = dispText.split(' ');
                // console.log(dispArr);

                // executes math functions
                operate();

                //for clearing the input when more buttons are pressed later
                opFlag = 1;

            // when clear button is pressed, clear input and result fields
            } else if (e.path[0].id == 'bclear') {
                clear();

            // when back button is pressed
            } else if (e.path[0].className == 'bback') {
                back = document.querySelector('.input').textContent;

                // check if the last element is a space (would follow an oprator)
                lastSpaceIndex = back.lastIndexOf(' ');

                // if the last element is a space (therefore the one before that is an operator and before that is another space), slice all three elements off the end
                if (lastSpaceIndex == back.length - 1) {
                    document.querySelector('.input').textContent = document.querySelector('.input').textContent.slice(0,lastSpaceIndex - 1);
                    // console.log(document.querySelector('.input').textContent);
                } else {

                // if the last element is a number, slice it off the end
                    document.querySelector('.input').textContent = document.querySelector('.input').textContent.slice(0,back.length - 1);
                    // console.log(document.querySelector('.input').textContent);
                }

            }
        })
    });

    // executes math functions on dispArr
    function operate() {
        console.log(dispArr);

        

        // runs through dispArr, checks for multiplication and division, execute if found
        for (i = 0 ; i < dispArr.length ; i++) {
            
            if (dispArr[i] == '*') {
                // if (dispArr[i + 1] == '' || dispArr[i + 1] == '.' || dispArr[i - 1] == '.') {
                //     invalidFlag = 1;
                // }
                dispArr.splice(i - 1, 3, multiply(dispArr[i - 1], dispArr[i + 1]));
                i = 0;
            }
            if (dispArr[i] == '/') {
                // if (dispArr[i + 1] == '' || dispArr[i + 1] == '.' || dispArr[i - 1] == '.') {
                //     document.querySelector('.result').innerHTML = 'invalid input';
                //     invalidFlag = 1;
                // }
                dispArr.splice(i - 1, 3, divide(dispArr[i - 1], dispArr[i + 1]));
                i = 0;
            }
        }

        // runs through dispArr, checks for addition and subtraction, execute if found
        for (i = 0 ; i < dispArr.length ; i++) {

            if (dispArr[i] == '+') {
                // if (dispArr[i + 1] == '' || dispArr[i + 1] == '.' || dispArr[i - 1] == '.') {
                //     document.querySelector('.result').innerHTML = 'invalid input';
                //     invalidFlag = 1;
                // }
                dispArr.splice(i - 1, 3, add(dispArr[i - 1],dispArr[i + 1]));
                i = 0;
            }
            if (dispArr[i] == '-') {
                // if (dispArr[i + 1] == '' || dispArr[i + 1] == '.' || dispArr[i - 1] == '.') {
                //     document.querySelector('.result').innerHTML = 'invalid input';
                //     invalidFlag = 1;
                // }
                dispArr.splice(i - 1, 3, subtract(dispArr[i - 1],dispArr[i + 1]));
                i = 0;
            }
        }
        

        // checks for more than one operator in a row
        for (i = 0 ; i < dispArr.length ; i++) {

            console.log(dispArr);
            console.log('i: ', dispArr[i]);
            console.log('i + 1: ',dispArr[i + 1]);
            // if (((dispArr[i] == '*' || dispArr[i] == '/' || dispArr[i] == '+' || dispArr[i] == '-' || dispArr[i] == '.') 
            // && (dispArr[i + 1] == '*' || dispArr[i + 1] == '/' || dispArr[i + 1] == '+' || dispArr[i + 1] == '-' || dispArr[i + 1] == '.'))
            // || dispArr[dispArr.length] == '' || dispArr[dispArr.length] == 'undefined' || dispArr[dispArr.length - 1] == '*' || dispArr[dispArr.length - 1] == '/' || dispArr[dispArr.length - 1] == '+' || dispArr[dispArr.length - 1] == '-'  || dispArr[dispArr.length - 1] == '.') {
            if ((!isNum(disp.Arr[i]) && !isNum(disp.Arr[i + 1])) || !isNum(dispArr[dispArr.length])) {
                document.querySelector('.result').innerHTML = 'invalid input';
                console.log('invalid input');
                invalidFlag = 1;    
            }
        }
        //prints the dispArr to the result field after rounding it

        if (invalidFlag == 0) {
            final = dispArr[0];
            final = final.toFixed(3);
            document.querySelector('.result').innerHTML = dispArr[0];
        }

    }

    // clears the input and result
    function clear() {
        document.querySelector('.input').innerHTML = '';
        document.querySelector('.result').innerHTML = '';
        disp = {};
        dispArr = [];
        result = 0;
        opFlag = 0;
        last = '';
        back = '';
        lastSpaceIndex = 0;

    }

    function isNum(a) {
        if (a == '*' || a == '/' || a == '+' || a == '-' || a== '.' || a== ' ' || a== '' || a== 'undefined') {
            return 0;
        } else return 1;
    }





    </script>
</body>
</html>